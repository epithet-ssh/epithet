# Example epithet configuration file
#
# Location: ~/.epithet/*.yaml (or .yml, .cue, .json)
#
# Format: YAML (also supports CUE and JSON)
# Config sections mirror the CLI command structure
#
# Multi-file support:
#   All config files in ~/.epithet/ are loaded and merged using CUE unification.
#   This allows splitting config across multiple files (e.g., base.yaml, work.yaml).
#   Conflicting values (same field, different values) will cause an error at startup.

# Global flags (apply to all commands)
# insecure: true           # Disable TLS verification (NOT RECOMMENDED)
# verbose: 1               # Log level (1=info, 2=debug)
# log_file: /var/log/epithet.log
# tls_ca_cert: /path/to/ca.crt

# Agent configuration (epithet agent)
# Host patterns are obtained dynamically from CA discovery - no static match config needed
agent:
  ca_url: https://ca.example.com
  auth: epithet auth oidc --issuer https://accounts.google.com --client-id YOUR_CLIENT_ID

# CA server configuration (epithet ca)
# ca:
#   policy: https://policy.example.com
#   key: /etc/epithet/ca.key
#   listen: "0.0.0.0:8080"

# Policy server configuration (epithet policy)
# All policy config is now unified here - no separate policy.yaml needed
# policy:
#   listen: "0.0.0.0:9999"
#   ca_pubkey: ssh-ed25519 AAAAC3...  # or URL like https://ca.example.com/pubkey
#   default_expiration: "5m"
#
#   # OIDC configuration for token validation
#   oidc:
#     issuer: "https://accounts.google.com"
#     audience: "your-client-id"
#
#   # Map users (by email) to tags (roles/teams)
#   users:
#     alice@example.com: [admin, eng]
#     bob@example.com: [eng]
#
#   # Default policy settings (apply to all hosts)
#   defaults:
#     allow:
#       wheel: [admin]         # users with "admin" tag get "wheel" principal
#       developers: [eng]      # users with "eng" tag get "developers" principal
#     extensions:
#       permit-pty: ""
#       permit-agent-forwarding: ""
#
#   # Per-host policy overrides
#   hosts:
#     "*.prod.example.com":
#       expiration: "2m"       # shorter expiration for production
#       allow:
#         root: [admin]        # only admins can access as root

# Auth OIDC configuration (epithet auth oidc)
# auth:
#   oidc:
#     issuer: https://accounts.google.com
#     client_id: YOUR_CLIENT_ID
#     client_secret: YOUR_CLIENT_SECRET  # Optional if using PKCE
#     scopes:
#       - openid
#       - email
#       - profile

# Note: Broker socket and agent directories are automatically managed
# in ~/.epithet/run/<instance-id>/ - no configuration needed!
