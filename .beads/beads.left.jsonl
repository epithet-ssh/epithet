{"id":"epithet-1","content_hash":"530225b91e5ede5cb94c625c143011182ed3b715a20d31a761637989029064b1","title":"Broker authentication mechanism","description":"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:04:14.581322-07:00","closed_at":"2025-10-27T16:04:14.581325-07:00","source_repo":"."}
{"id":"epithet-10","content_hash":"977d019c83f08e26f8794ed35c4fe3a945d427a60de96cbeb29e9d890700a2c8","title":"Implement token refresh on certificate expiry","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T12:00:11.742798-07:00","closed_at":"2025-10-25T12:00:11.742798-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-10","depends_on_id":"epithet-1","type":"parent-child","created_at":"2025-10-22T16:09:07.717454-07:00","created_by":"import"}]}
{"id":"epithet-11","content_hash":"b6c9793ec833379b9eadae43f4c5bed5205d9c96aceb53612f4a9675142a8213","title":"Implement error handling and retry logic for auth","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:04:14.503926-07:00","closed_at":"2025-10-27T16:04:14.503933-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-11","depends_on_id":"epithet-1","type":"parent-child","created_at":"2025-10-22T16:09:07.717949-07:00","created_by":"import"}]}
{"id":"epithet-12","content_hash":"d5bfce63e77a5e9714940b863793ef9dcd21bbfe59604e414ad0e85f3222df97","title":"epithet match command implementation","description":"","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:28:22.033941-07:00","closed_at":"2025-10-25T15:28:22.033941-07:00","source_repo":"."}
{"id":"epithet-13","content_hash":"862b84fc61e2087e6135ffa4d4c886ffa3fa8cd5d69f6fa7aadba81dac40ef74","title":"Broker \u2192 CA integration","description":"","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:04:51.937739-07:00","closed_at":"2025-10-27T16:04:51.937744-07:00","source_repo":"."}
{"id":"epithet-14","content_hash":"824b93ad56a2d1050779dd8adac98c403b09551b68c99b55d9896cdf40493e30","title":"Broker \u2192 Agent management","description":"","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:04:52.022792-07:00","closed_at":"2025-10-27T16:04:52.022795-07:00","source_repo":"."}
{"id":"epithet-15","content_hash":"4281a056a9e8405ad161b687730fdc15d24705bc0e9a8d7aa039f20744306299","title":"Infrastructure improvements","description":"","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:04:52.101259-07:00","closed_at":"2025-10-27T16:04:52.101263-07:00","source_repo":"."}
{"id":"epithet-16","content_hash":"d526c866292a234bf204d3fe3e881b56ff4de18feee23e17546a0ce6f1cb0606","title":"Create match command structure accepting --host, --port, --user, --hash arguments","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-22T16:09:07.715489-07:00","closed_at":"2025-10-22T16:35:23.674384024Z","source_repo":".","dependencies":[{"issue_id":"epithet-16","depends_on_id":"epithet-12","type":"parent-child","created_at":"2025-10-22T16:09:07.718368-07:00","created_by":"import"}]}
{"id":"epithet-17","content_hash":"e481a8dd6f20166e19ff1193cac31034529eba52945174acbc906168905a21d6","title":"Implement communication protocol with broker (IPC/RPC)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-22T16:09:07.715489-07:00","closed_at":"2025-10-22T16:36:08.321394864Z","source_repo":".","dependencies":[{"issue_id":"epithet-17","depends_on_id":"epithet-12","type":"parent-child","created_at":"2025-10-22T16:09:07.718711-07:00","created_by":"import"}]}
{"id":"epithet-18","content_hash":"f74475d5bc1c368b4b5211e351a174a69ef72d8c84e2f2685778cd4f34c25cb1","title":"Implement 5-step certificate validation workflow","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:03:32.80585-07:00","closed_at":"2025-10-25T15:03:32.80585-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-18","depends_on_id":"epithet-12","type":"parent-child","created_at":"2025-10-22T16:09:07.719097-07:00","created_by":"import"}]}
{"id":"epithet-19","content_hash":"8c0825a0e82d20428994e84160e9528ecb0fd4adddc84bbaedcc38eb9f46c831","title":"Add host eligibility checking (match patterns)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:28:02.945282-07:00","closed_at":"2025-10-25T15:28:02.945282-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-19","depends_on_id":"epithet-12","type":"parent-child","created_at":"2025-10-22T16:09:07.719466-07:00","created_by":"import"}]}
{"id":"epithet-20","content_hash":"18d1e9771124fa1a5b6ad52fb0edc11984b0e2405287f6b3fc9a8c357cb96382","title":"Return success/failure to OpenSSH properly","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-22T16:09:07.715489-07:00","closed_at":"2025-10-22T16:36:42.750426903Z","source_repo":".","dependencies":[{"issue_id":"epithet-20","depends_on_id":"epithet-12","type":"parent-child","created_at":"2025-10-22T16:09:07.719802-07:00","created_by":"import"}]}
{"id":"epithet-21","content_hash":"f5d8497295e04d442fbe19e0a1b82d1df9d9eb02285f55ed9d4e3de8c23f6c3c","title":"Implement certificate request flow: auth token \u2192 CA \u2192 signed certificate","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:10:02.800425-07:00","closed_at":"2025-10-25T15:10:02.800425-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-21","depends_on_id":"epithet-13","type":"parent-child","created_at":"2025-10-22T16:09:07.720137-07:00","created_by":"import"}]}
{"id":"epithet-22","content_hash":"358f4d929ddae3fbdf7a3078381f10c5133b66baa44dd6793b13608c41b06cd1","title":"Pass connection details (host, user, port) to CA for principal determination","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:10:02.875796-07:00","closed_at":"2025-10-25T15:10:02.875796-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-22","depends_on_id":"epithet-13","type":"parent-child","created_at":"2025-10-22T16:09:07.720431-07:00","created_by":"import"}]}
{"id":"epithet-23","content_hash":"5d308f51dc470133d6a304686af60eecd2d273b580f987cf9f5cbb0c32373059","title":"Handle CA errors and policy denials","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:04:37.717921-07:00","closed_at":"2025-10-27T16:04:37.717927-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-23","depends_on_id":"epithet-13","type":"parent-child","created_at":"2025-10-22T16:09:07.720708-07:00","created_by":"import"}]}
{"id":"epithet-24","content_hash":"bed763ff58d22665d3ea76e04728ecc0220388e7d4f0364b34a98038501c5ed6","title":"Store returned certificates with expiry times","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:10:13.727953-07:00","closed_at":"2025-10-25T15:10:13.727953-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-24","depends_on_id":"epithet-13","type":"parent-child","created_at":"2025-10-22T16:09:07.720997-07:00","created_by":"import"}]}
{"id":"epithet-25","content_hash":"8f7971beb69847cc54ff54a9a6b886a497ab88c2933ef6e771037bd63962f4f0","title":"Create per-connection agent instances using pkg/agent.Agent","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:10:13.805836-07:00","closed_at":"2025-10-25T15:10:13.805836-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-25","depends_on_id":"epithet-14","type":"parent-child","created_at":"2025-10-22T16:09:07.721274-07:00","created_by":"import"}]}
{"id":"epithet-26","content_hash":"e5f25a030f8423bf0bddd171d08497ca05383b86a13da4039d021b688acbd6c5","title":"Implement map connection hash (%C) \u2192 agent instance","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:10:23.197188-07:00","closed_at":"2025-10-25T15:10:23.197188-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-26","depends_on_id":"epithet-14","type":"parent-child","created_at":"2025-10-22T16:09:07.721543-07:00","created_by":"import"}]}
{"id":"epithet-27","content_hash":"a7f0ef0b04cdb2bf16b2770a5c4ecd82acbf4a68f21393748d9404b01db8b4cc","title":"Implement agent socket path management at ~/.epithet/sockets/%C","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:10:23.276431-07:00","closed_at":"2025-10-25T15:10:23.276431-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-27","depends_on_id":"epithet-14","type":"parent-child","created_at":"2025-10-22T16:09:07.721819-07:00","created_by":"import"}]}
{"id":"epithet-28","content_hash":"e2ae162480776ca27211fbdb08856ac1b6a15ca0b4a169e557f1b34f5f9be2a2","title":"Implement certificate swapping/renewal in existing agents (via UseCredential)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:10:38.620417-07:00","closed_at":"2025-10-25T15:10:38.620417-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-28","depends_on_id":"epithet-14","type":"parent-child","created_at":"2025-10-22T16:09:07.722075-07:00","created_by":"import"}]}
{"id":"epithet-29","content_hash":"18074bbc12b9529854195b41bf764ee7ceddf2175746ec00e350fd070d8c9405","title":"Implement agent lifecycle and cleanup","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:10:38.697488-07:00","closed_at":"2025-10-25T15:10:38.697488-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-29","depends_on_id":"epithet-14","type":"parent-child","created_at":"2025-10-22T16:09:07.722345-07:00","created_by":"import"}]}
{"id":"epithet-30","content_hash":"e6d1af7518fe39378e997d5f0d2c8d0269bcfa0015ec24912253092a18923004","title":"Implement match pattern evaluation (which hosts epithet should handle)","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T15:42:57.317814-07:00","closed_at":"2025-10-25T15:42:57.317814-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-30","depends_on_id":"epithet-15","type":"parent-child","created_at":"2025-10-22T16:09:07.722621-07:00","created_by":"import"}]}
{"id":"epithet-31","content_hash":"64b895cff2fd5015ca10713a248cfecaa0f9cef7b0d4ef2dbd7f020a83d4a276","title":"Implement proper error handling throughout broker","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:04:37.796476-07:00","closed_at":"2025-10-27T16:04:37.796482-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-31","depends_on_id":"epithet-15","type":"parent-child","created_at":"2025-10-22T16:09:07.722886-07:00","created_by":"import"}]}
{"id":"epithet-32","content_hash":"a979d102c6eb9e5380efbad618337bf7091d798252c6e10c265224b38a537415","title":"Add logging and observability","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:04:37.870628-07:00","closed_at":"2025-10-27T16:04:37.870634-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-32","depends_on_id":"epithet-15","type":"parent-child","created_at":"2025-10-22T16:09:07.723201-07:00","created_by":"import"}]}
{"id":"epithet-33","content_hash":"b8f1cc0a3bdaeb2116977609c6c0d97c0292a2e3a1f96e5f421a5d429caa5ba9","title":"Implement socket cleanup on expiration","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T16:55:50.724833-07:00","closed_at":"2025-10-27T16:55:50.724838-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-33","depends_on_id":"epithet-15","type":"parent-child","created_at":"2025-10-22T16:09:07.723517-07:00","created_by":"import"}]}
{"id":"epithet-34","content_hash":"c89dda1b7dfa36e4cc21eab817fb0ca2ae82e8915bb70cbea6cadb78fdd7b974","title":"Implement graceful shutdown","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T18:36:07.515899-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-34","depends_on_id":"epithet-15","type":"parent-child","created_at":"2025-10-22T16:09:07.723805-07:00","created_by":"import"}]}
{"id":"epithet-35","content_hash":"0f5e3e9a3ea37e513a22238e59548063e71662322b91eca4e116ab8b6b3e598d","title":"Implement less strict netstring parser that tolerates whitespace for debugging","description":"The current auth plugin protocol uses the markdingo/netstring library which strictly rejects whitespace between netstrings. This makes debugging auth plugins difficult. We should implement a custom netstring parser that tolerates whitespace (spaces, tabs, \\n, \\r) between netstrings while still being strict about the netstring format itself. Location: README.md:85","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-27T15:29:47.238797-07:00","closed_at":"2025-10-27T15:29:47.2388-07:00","source_repo":"."}
{"id":"epithet-36","content_hash":"982d1c3a73b8bf7fcbbc42b0c4fddbb9fe9487b9dc53da22db49d60d38a964bf","title":"Replace /tmp/foooo with proper tempfile location and cleanup in broker_test.go","description":"In pkg/broker/broker_test.go:18, replace hardcoded /tmp/foooo with a proper temporary file that gets cleaned up after tests","status":"closed","priority":3,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-22T16:09:07.715489-07:00","closed_at":"2025-10-22T16:17:39.883538258Z","source_repo":"."}
{"id":"epithet-37","content_hash":"c47e67c9679575a437fabddd826d466a1f0c1384ddbf1561e907ce0536f863ad","title":"Fill in the rest of the %C connection fields in broker.go","description":"In pkg/broker/broker.go:30, the ConnectionInfo struct needs the remaining fields from the %C hash (local hostname, remote hostname, port, username, ProxyJump)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-22T16:09:07.715489-07:00","closed_at":"2025-10-22T16:18:48.190311982Z","source_repo":"."}
{"id":"epithet-38","content_hash":"737b67baf67a8652bf79abeedcaa1e31cc306a72008970a3665eec1a8354833a","title":"Wire up epithet match arguments to broker MatchRequest RPC","description":"Add CLI arguments to MatchCLI (--host, --port, --user, --hash) and implement RPC call to broker passing all MatchRequest fields including derived LocalHost/LocalUser","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-22T16:09:07.715489-07:00","closed_at":"2025-10-22T16:22:47.109966271Z","source_repo":".","dependencies":[{"issue_id":"epithet-38","depends_on_id":"epithet-37","type":"discovered-from","created_at":"2025-10-22T16:09:07.724121-07:00","created_by":"import"}]}
{"id":"epithet-39","content_hash":"f8b79f6dda88d20429370b52ace66b57e03ccfc527110cc1ef49608e805fd83f","title":"Implement initial authentication in broker.Match when no token exists","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-25T12:00:33.253643-07:00","updated_at":"2025-10-25T12:05:49.332212-07:00","closed_at":"2025-10-25T12:05:49.332212-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-39","depends_on_id":"epithet-1","type":"blocks","created_at":"2025-10-25T12:00:33.256094-07:00","created_by":"daemon"}]}
{"id":"epithet-40","content_hash":"49674a386589856467efe65fda21adcba4fd377d681cee6a5881bd7faad0ef55","title":"Handle re-authentication when CA returns 403/Forbidden","description":"","design":"Use standard HTTP semantics for auth vs authz failures:\n\n401 from CA/policy server:\n- Means: Token is invalid, expired, or missing\n- Broker action: Clear auth.token, call auth.Run() to re-authenticate, retry cert request with new token\n- User experience: Brief pause while re-authenticating, then connection proceeds (or fails for other reason)\n\n403 from CA/policy server:\n- Means: Token is valid (user authenticated), but not authorized for this access\n- May be temporary (approval workflow pending) or permanent (user lacks permission)\n- Broker action: Keep token (still valid!), return policy server error message to user, do NOT auto-retry\n- User experience: See error message explaining why (e.g., 'Approval required from ops-team'), can manually retry after approval granted\n\nThis distinction is important because:\n- 403 might resolve later (approval granted) with same token - don't force re-auth\n- 401 won't resolve without new token - must re-auth\n- Follows standard HTTP semantics (401=authentication, 403=authorization)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-25T12:00:36.648331-07:00","updated_at":"2025-10-27T16:03:48.592838-07:00","closed_at":"2025-10-27T16:03:48.592844-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-40","depends_on_id":"epithet-1","type":"blocks","created_at":"2025-10-25T12:00:36.650962-07:00","created_by":"daemon"}]}
{"id":"epithet-41","content_hash":"30f9c2b4f44db5be1099af7abe624a3c73ab7d07cb084644666bead86cd2c161","title":"Pass connection details to auth command for mustache template rendering","description":"Currently auth.Run() is called with nil. We should pass MatchRequest fields (host, user, port, etc.) so auth commands can use mustache templates like {{host}} or {{user}} in their command line configuration.","status":"open","priority":3,"issue_type":"task","created_at":"2025-10-25T12:11:30.932645-07:00","updated_at":"2025-10-25T12:11:30.932645-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-41","depends_on_id":"epithet-1","type":"blocks","created_at":"2025-10-25T12:11:30.934792-07:00","created_by":"daemon"}]}
{"id":"epithet-42","content_hash":"fa73aae4b575ef9c329847694b8cda9a279b606bc37cb1a0d6fe4253e32a757f","title":"Update caserver for v2: accept match data and return policy with certificate","description":"Currently CreateCertRequest only has token+publicKey. Need to add match data (RemoteHost, RemoteUser, Port, etc.) and pass to policy server. CreateCertResponse should return both certificate and policy pattern so broker can store it.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-25T12:16:55.355488-07:00","updated_at":"2025-10-25T12:18:32.616775-07:00","closed_at":"2025-10-25T12:18:32.616775-07:00","source_repo":"."}
{"id":"epithet-43","content_hash":"7e30a39eaaaa2a1863561e6c60b7a1a65043def2af49e50614b3e078af684bf2","title":"Add comprehensive concurrency documentation and fix race conditions","description":"Add locking invariants documentation to Broker, Agent, Auth, and CertificateStore. Remove unused Agent.lock field. Fix race condition in sshd test helper by wrapping bytes.Buffer with thread-safe safeBuffer. All code now passes race detector tests.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T15:43:03.632286-07:00","updated_at":"2025-10-25T15:43:08.355558-07:00","closed_at":"2025-10-25T15:43:08.355558-07:00","source_repo":"."}
{"id":"epithet-44","content_hash":"bb16a6bca458f4e274bffcea86316d7e33863cbc7e272d72923cc291212e9ca5","title":"Expand policy matching beyond hostname to support per-user certificates","description":"Current limitation: Policy only matches on hostPattern, but different remote users connecting to the same host may need different certificates with different principals (e.g., deploy@server vs root@server).\n\nProblem: If user SSHs to deploy@server.example.com (gets cert with principal 'deploy'), then later SSHs to root@server.example.com, the cert store lookup finds the existing cert (matches *.example.com) but it only has 'deploy' principal, not 'root', causing SSH to fail.\n\nSolution: Expand Policy struct to match on additional connection fields beyond just hostname:\n- remoteUser (e.g., 'deploy', 'root', '*')\n- Potentially localUser, port, etc.\n\nDesign questions to resolve:\n1. Should matching be AND logic (all fields must match) or pattern-based with wildcards per field?\n2. Should lookup prefer exact matches first, then fall back to broader patterns? Or most-specific-match-wins?\n3. How do we handle wildcard patterns in multiple dimensions?\n\nThis affects:\n- pkg/policy/policy.go - Policy struct and Matches() method\n- pkg/broker/certs.go - CertificateStore.Lookup() logic\n- Policy server API - may need to return more granular policies","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-25T18:39:38.843754-07:00","updated_at":"2025-10-25T18:39:38.843754-07:00","source_repo":"."}
{"id":"epithet-45","content_hash":"c9e805b0fc94fe6de0c6206065fcc4094f8a6236bfd2b0d175ac978271e52801","title":"Make broker socket path configurable to support multiple concurrent brokers","description":"Currently the broker socket path defaults to ~/.epithet/broker.sock, which prevents running multiple brokers concurrently. Need to make this configurable.\n\nUse case: User may want separate brokers for work vs personal, different CA servers, different match patterns, etc.\n\nExample setup:\n- Work broker: --broker-sock ~/.epithet/work-broker.sock --match *.work.example.com\n- Personal broker: --broker-sock ~/.epithet/personal-broker.sock --match *.personal.example.com\n\nChanges needed:\n1. epithet agent command: Already has default, keep it configurable via flag/config\n2. epithet match command: Add --broker flag to specify which broker to connect to (currently hardcoded in match.go)\n3. Update SSH config examples to show broker selection\n\nNote: Agent socket directory is already configurable via --agent-sock-dir flag \u2713\n\nFiles to update:\n- cmd/epithet/match.go - Add --broker flag, use instead of hardcoded path\n- cmd/epithet/agent.go - Already has --broker-sock flag \u2713\n- SSH config examples in docs\n","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T18:57:24.191353-07:00","updated_at":"2025-10-27T16:07:48.384628-07:00","closed_at":"2025-10-27T16:07:48.384634-07:00","source_repo":"."}
{"id":"epithet-46","content_hash":"96994c2af995e79d4ddfaf9b96cd212f1e12166dc57ac4ffbb17b8fb3c002f86","title":"Explore SSH Match exec behavior: can we fail just the Match or does it abort the entire SSH connection?","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-10-25T19:44:34.301361-07:00","updated_at":"2025-10-25T19:44:34.301361-07:00","source_repo":"."}
{"id":"epithet-47","content_hash":"c462d5314395ab1ea8dbab7cd2c90729c8a449e4198838d420a527d080dead1b","title":"Implement 401 retry logic in broker: clear token, re-auth, retry cert request (limit retries to prevent infinite loops)","description":"When CA returns 401 Unauthorized: 1) Clear the current token, 2) Invoke auth plugin (which may use refresh token from state or do full re-auth), 3) Retry cert request with new token. Limit retries to prevent infinite loops with buggy auth plugins (suggest max 2-3 attempts). Use immediate retries (no backoff delay) - if there's a persistent issue, user will see the error and can retry the SSH connection. If retries exhausted, fail the Match and log error to stderr per epithet-48.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-25T19:46:17.050687-07:00","updated_at":"2025-10-27T16:03:48.518019-07:00","closed_at":"2025-10-27T16:03:48.518026-07:00","source_repo":"."}
{"id":"epithet-48","content_hash":"446d20bb8a7b7dfc8b36877d695f2a253fff5b27dd4740c09b6a5971d027d50c","title":"When epithet cannot obtain certificate, fail the Match (return non-zero) and log clear error to stderr","description":"When epithet cannot obtain a certificate (auth failures, CA errors, etc), the Match exec should: 1) Log clear, user-friendly error message to stderr explaining what went wrong (verbosity matching configured log level - helpful by default, more detail with -v flags), 2) Exit with non-zero status to fail the Match, 3) Allow SSH to fall through to subsequent Match blocks or default config. This enables breakglass/fallback scenarios where users have epithet Match blocks first, followed by special-case configs (e.g., breakglass@host with specific IdentityFile). Trade-off: May leak connection attempts to fallback systems, but this is acceptable to enable legitimate escape hatches.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-25T19:51:28.702502-07:00","updated_at":"2025-10-27T16:03:48.667018-07:00","closed_at":"2025-10-27T16:03:48.667023-07:00","source_repo":"."}
{"id":"epithet-49","content_hash":"fc49e9c0bc34d53ad4fb06aa5e730c074ff42dbe2a7f1d47e604fd6b2df74ddb","title":"Handle agent creation failures: keep cert in store, fail Match with clear error about local system issue","description":"When certificate is valid but agent creation fails (socket directory permissions, disk space, etc): 1) Keep certificate in cert store (it's valid and may work on retry or for other connections), 2) Fail the Match with clear error explaining the agent creation problem (not a cert/auth issue), 3) User can fix local issue and retry. Agent creation failures are typically local system problems, not certificate/policy problems.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-25T20:03:10.81255-07:00","updated_at":"2025-10-27T16:04:37.643402-07:00","closed_at":"2025-10-27T16:04:37.643412-07:00","source_repo":"."}
{"id":"epithet-50","content_hash":"7017d3f15748c1dc4f243998af721938f3f4eafd7fb05e896c80b811184896bb","title":"Parse SSH certificate ValidBefore field to get actual expiry time instead of hardcoding 5 minutes","description":"Currently broker.Match() and ensureAgent() hardcode 5-minute expiry with TODO comments. Need to parse the SSH certificate to extract ValidBefore timestamp and use that for expiration tracking in agentEntry and PolicyCert. The golang.org/x/crypto/ssh library provides this functionality. Certificate is the source of truth for expiry time.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-10-25T20:05:43.536749-07:00","updated_at":"2025-10-27T16:03:16.619446-07:00","closed_at":"2025-10-27T16:03:16.619452-07:00","source_repo":"."}
{"id":"epithet-51","content_hash":"f5a2916688c7be8e2a4894f3bb87445ebd1ba2a976ec30134cd86d1d02bb20fb","title":"Migrate to pkg/netstr and remove old netstring library","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-27T15:25:37.455291-07:00","updated_at":"2025-10-27T15:29:54.452211-07:00","closed_at":"2025-10-27T15:29:54.452214-07:00","source_repo":"."}
{"id":"epithet-52","content_hash":"a3466653be4c90e3bf969a0e00b7f207e3309f8167caeeb94aa72cafc9b555aa","title":"Extract pkg/netstr into standalone library","description":"","status":"open","priority":3,"issue_type":"task","created_at":"2025-10-27T15:59:38.496556-07:00","updated_at":"2025-10-27T15:59:38.496556-07:00","source_repo":"."}
{"id":"epithet-53","content_hash":"30e5f93824ced0608eaee9c42fff5e3346e7011d58560ffd143b043ac8164e33","title":"Switch auth plugin protocol to fd 3 approach","description":"Replace netstring-based protocol with simpler file descriptor approach. New protocol: stdin=state, stdout=token, fd3=new_state, stderr=errors. No encoding needed, state never touches disk, easy in all languages. Changes: update CLAUDE.md docs, remove pkg/netstr, update broker to use pipes, update examples.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-27T19:50:51.322878-07:00","updated_at":"2025-10-27T20:06:09.973441-07:00","closed_at":"2025-10-27T20:06:09.973441-07:00","source_repo":"."}
{"id":"epithet-54","content_hash":"6a2c95f6be34aab5550829b210b756e547029febc692fd069d43f6e106386df8","title":"Support ProxyJump by adding multiple certificates to per-connection agents","description":"","notes":"FALSE ALARM - No work needed!\n\nAfter detailed analysis, the per-connection agent design ALREADY handles ProxyJump correctly:\n\n1. Each hop in a ProxyJump chain spawns a separate SSH process on local machine\n2. Each process reads ~/.ssh/config and evaluates Match exec independently  \n3. Each process gets its own %C hash (which includes %j - the ProxyJump value)\n4. Each process uses its own IdentityAgent socket path (based on its unique %C)\n5. epithet match is called separately for each hop with the correct target host\n\nExample: ssh -J jumphost remote\n- SSH Process 1: Match exec for jumphost -> agent at %C_jump with jumphost cert\n- SSH Process 2: Match exec for remote -> agent at %C_remote with remote cert\n\nBoth processes authenticate independently with their respective certificates. The design is sound!\n\nThe %j field is still useful for:\n- Logging/debugging (knowing which connections use jumps)\n- Policy decisions (CA might care if connection uses ProxyJump)\n- Future optimizations\n\nBut core functionality works without any code changes.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-10-29T20:36:50.010906-07:00","updated_at":"2025-10-29T20:43:17.385604-07:00","closed_at":"2025-10-29T20:43:05.55326-07:00","source_repo":"."}
{"id":"epithet-55","content_hash":"8d792c0f3226fba8446df1dfe8efbfd11621068a4634cbc92dd4132f42fe8738","title":"Simplify dev policy server to only allow-all and deny-all modes","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-31T15:07:33.819211-07:00","updated_at":"2025-10-31T15:08:52.812267-07:00","closed_at":"2025-10-31T15:08:52.812267-07:00","source_repo":"."}
{"id":"epithet-56","content_hash":"4496d63c342a6c4a27b19b7e70a608ec7b45e2747b3ddffb905c6a7a19520bc2","title":"Update development-tools.md to remove pattern-based mode references","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-31T15:11:02.462729-07:00","updated_at":"2025-10-31T15:11:49.958437-07:00","closed_at":"2025-10-31T15:11:49.958437-07:00","source_repo":"."}
{"id":"epithet-57","content_hash":"68c9da3ce7976cbe5f1f40c7321357ff566a76e9f37a63baab6046d79ec29325","title":"Add --ca-pubkey flag to dev policy server for signature verification","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-31T15:12:39.542406-07:00","updated_at":"2025-10-31T15:13:44.674776-07:00","closed_at":"2025-10-31T15:13:44.674776-07:00","source_repo":"."}
{"id":"epithet-58","content_hash":"9f018a6b04ccbb6ec0f0d716a3a819fd1858380a8ebf977443ca1263e16aa533","title":"Update --ca-pubkey to accept URL, file path, or literal key","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-31T15:16:03.9881-07:00","updated_at":"2025-10-31T15:18:07.932844-07:00","closed_at":"2025-10-31T15:18:07.932844-07:00","source_repo":"."}
{"id":"epithet-59","content_hash":"45f7782f2480a0b7d5e2612de90a39cce4d1610057441a86776352f45b19807f","title":"Update README.md to reflect new dev policy server changes","description":"","status":"closed","priority":2,"issue_type":"task","created_at":"2025-10-31T15:18:58.960645-07:00","updated_at":"2025-10-31T15:19:19.874349-07:00","closed_at":"2025-10-31T15:19:19.874349-07:00","source_repo":"."}
{"id":"epithet-60","content_hash":"e0077bb44692b6e2f0d4466c89e35f4a1c42b0b3fa499bcccd39584e61ca7033","title":"Set up OpenTofu example deployment for AWS Lambda + API Gateway","description":"","status":"open","priority":2,"issue_type":"feature","created_at":"2025-11-01T12:12:28.969253-07:00","updated_at":"2025-11-01T12:12:28.969253-07:00","source_repo":"."}
{"id":"epithet-61","content_hash":"74e90ab17dc476a89ebde8343553ccf732737031a5bd9c36bd0f895af01ac3e9","title":"Add 'epithet aws ca' subcommand for Lambda deployment","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-01T12:26:16.359635-07:00","updated_at":"2025-11-01T12:26:16.359635-07:00","source_repo":"."}
{"id":"epithet-62","content_hash":"eba2abcd6ec181a13ab25f4e18fd8802cfffabf4ad5c8930ba410b2ee14a2b18","title":"Replace Go policy Lambda with Python implementation","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-02T14:51:59.946139-08:00","updated_at":"2025-11-02T14:51:59.946139-08:00","source_repo":"."}
{"id":"epithet-63","content_hash":"e42845cdd7af6e0a6e0182cdd0ca201da2ca19a6377fbbfe883a0195b2fe8353","title":"Make config file template expansion more robust","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-09T13:40:28.675409-08:00","updated_at":"2025-11-09T13:40:28.675409-08:00","source_repo":"."}
{"id":"epithet-64","content_hash":"1a98961e506f9d6bd6b3abcedccb96acdabef26df08762e28869cc77249f8b7c","title":"Fix Python policy Lambda dependency packaging for ARM64","description":"","status":"open","priority":2,"issue_type":"task","created_at":"2025-11-09T14:43:23.569986-08:00","updated_at":"2025-11-09T14:43:23.569986-08:00","source_repo":"."}
{"id":"epithet-65","content_hash":"46de055123420bb7574c810120723a528c3fa03aa5e4845077b76542570f0ae8","title":"Implement epithet auth oidc command for Google Workspace and other OIDC providers","description":"","status":"open","priority":1,"issue_type":"feature","created_at":"2025-11-09T19:29:35.865063-08:00","updated_at":"2025-11-09T19:29:35.865063-08:00","source_repo":"."}
{"id":"epithet-66","content_hash":"4c179712a802f2b6a14f58e522ab7dd3694a4fd3d6ad94059618bc4f25244075","title":"Add OIDC dependencies to go.mod","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-09T19:29:43.80108-08:00","updated_at":"2025-11-09T19:29:43.80108-08:00","source_repo":"."}
{"id":"epithet-67","content_hash":"490feb605f4d853a1fa069ff32271869e51537604a811c8c8ef66c2cead1691b","title":"Create pkg/auth/oidc package with core auth flow","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-09T19:29:43.850623-08:00","updated_at":"2025-11-09T19:29:43.850623-08:00","source_repo":"."}
{"id":"epithet-68","content_hash":"99def6417e8020ee70a1878bdb155d2afe4dc5fe23d8748b595b83881f502e07","title":"Add cmd/epithet/auth_oidc.go command","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-09T19:29:43.90002-08:00","updated_at":"2025-11-09T19:29:43.90002-08:00","source_repo":"."}
{"id":"epithet-69","content_hash":"7f84a3731dd60a782ec893a2b18932dfcaf50831ce3cdee07d1f2e4a2c36b499","title":"Write documentation for OIDC auth setup","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-09T19:29:43.946655-08:00","updated_at":"2025-11-09T19:29:43.946655-08:00","source_repo":"."}
{"id":"epithet-7","content_hash":"f90419a28e24fcbf2d03cee02d539ebd90c5d97c3e7a0d6a1f85c4ca446c6fbc","title":"Implement auth command invocation (stdin/stdout protocol)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-22T16:09:07.715489-07:00","closed_at":"2025-10-22T22:18:39.64510665Z","source_repo":".","dependencies":[{"issue_id":"epithet-7","depends_on_id":"epithet-1","type":"parent-child","created_at":"2025-10-22T16:09:07.72441-07:00","created_by":"import"}]}
{"id":"epithet-70","content_hash":"d96c1bcb7310d7fd265ae25b5ee0aa6d0c96638d6079ac362a2e636c59c15650","title":"Add tests for OIDC auth flow","description":"","status":"open","priority":1,"issue_type":"task","created_at":"2025-11-09T19:29:43.996024-08:00","updated_at":"2025-11-09T19:29:43.996024-08:00","source_repo":"."}
{"id":"epithet-8","content_hash":"46b431ec5f62acc3ba647405358f9e0d0158b7b1f0a7f4482769a4cfe92efc1e","title":"Implement auth state storage (map of user identity \u2192 state blob)","description":"","design":"Auth type already implements state cycling correctly in auth.go:127-171. Task is to change broker from single 'auth *Auth' to 'auths map[string]*Auth' where key is user identity (probably LocalUser from MatchRequest). Need method like GetOrCreateAuth(userID) that returns *Auth for that user.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-22T16:09:07.715489-07:00","closed_at":"2025-10-22T22:16:49.792978424Z","source_repo":".","dependencies":[{"issue_id":"epithet-8","depends_on_id":"epithet-1","type":"parent-child","created_at":"2025-10-22T16:09:07.724683-07:00","created_by":"import"}]}
{"id":"epithet-9","content_hash":"ddfddf380ef7dc641648cb5fb75a9d2945a211ab6676c295ce8799a41e5784fb","title":"Implement certificate storage (map of connection hash \u2192 certificate + expiry)","description":"","status":"closed","priority":1,"issue_type":"task","created_at":"2025-10-22T16:09:07.715489-07:00","updated_at":"2025-10-25T11:32:56.612656-07:00","closed_at":"2025-10-25T11:32:56.612656-07:00","source_repo":".","dependencies":[{"issue_id":"epithet-9","depends_on_id":"epithet-1","type":"parent-child","created_at":"2025-10-22T16:09:07.724945-07:00","created_by":"import"}]}
